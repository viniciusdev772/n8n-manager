<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>N8N Manager</title>
  <link rel="stylesheet" href="/ui/style.css">
</head>
<body>

  <!-- Login -->
  <div id="login-screen" class="login-screen">
    <div class="login-card">
      <div class="login-logo">N8N<span>Manager</span></div>
      <p class="login-subtitle">Insira o token de acesso para continuar</p>
      <input type="password" id="token-input" placeholder="Bearer Token" autocomplete="off">
      <button id="login-btn" onclick="doLogin()">Entrar</button>
      <p id="login-error" class="error hidden"></p>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="hidden">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">N8N<span>Manager</span></div>
      <nav>
        <button class="nav-btn active" data-page="dashboard" onclick="navigate('dashboard')">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
          Dashboard
        </button>
        <button class="nav-btn" data-page="instances" onclick="navigate('instances')">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="4" rx="1"/><rect x="2" y="14" width="20" height="4" rx="1"/><circle cx="6" cy="8" r="1" fill="currentColor"/><circle cx="6" cy="16" r="1" fill="currentColor"/></svg>
          Instancias
        </button>
        <button class="nav-btn" data-page="jobs" onclick="navigate('jobs')">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
          Fila de Jobs
        </button>
        <button class="nav-btn" data-page="create" onclick="navigate('create')">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
          Criar Instancia
        </button>
        <button class="nav-btn" data-page="cleanup" onclick="navigate('cleanup')">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3,6 5,6 21,6"/><path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6"/><path d="M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2v2"/></svg>
          Cleanup
        </button>
        <button class="nav-btn" data-page="debug" onclick="navigate('debug')">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
          Debug
        </button>
      </nav>
      <button class="nav-btn logout-btn" onclick="doLogout()">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Sair
      </button>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Dashboard -->
      <section id="page-dashboard" class="page">
        <h1>Dashboard</h1>
        <div class="cards" id="dashboard-cards">
          <div class="card">
            <div class="card-label">Status</div>
            <div class="card-value" id="dash-status">--</div>
          </div>
          <div class="card">
            <div class="card-label">Instancias Ativas</div>
            <div class="card-value" id="dash-active">--</div>
          </div>
          <div class="card">
            <div class="card-label">Capacidade</div>
            <div class="card-value" id="dash-capacity">--</div>
          </div>
          <div class="card">
            <div class="card-label">Redis</div>
            <div class="card-value" id="dash-redis">--</div>
          </div>
          <div class="card">
            <div class="card-label">Docker</div>
            <div class="card-value" id="dash-docker">--</div>
          </div>
        </div>
        <div id="dash-jobs-section" class="hidden">
          <h2>Jobs em Andamento</h2>
          <div id="dash-jobs-list" class="table-wrap"></div>
        </div>
        <h2>Instancias Recentes</h2>
        <div id="dash-instances-list" class="table-wrap"></div>
      </section>

      <!-- Jobs -->
      <section id="page-jobs" class="page hidden">
        <div class="page-header">
          <h1>Fila de Jobs</h1>
          <button class="btn btn-sm" onclick="loadJobs()">Atualizar</button>
        </div>
        <p class="subtitle">Jobs de criacao de instancias em andamento.</p>
        <div id="jobs-list" class="table-wrap"></div>
        <div id="jobs-empty" class="hidden" style="color:var(--text3);padding:1rem">Nenhum job ativo no momento.</div>
      </section>

      <!-- Instances -->
      <section id="page-instances" class="page hidden">
        <div class="page-header">
          <h1>Instancias</h1>
          <button class="btn btn-sm" onclick="loadInstances()">Atualizar</button>
        </div>
        <div id="instances-list" class="table-wrap"></div>
      </section>

      <!-- Instance Detail -->
      <section id="page-instance-detail" class="page hidden">
        <button class="btn btn-sm btn-ghost" onclick="navigate('instances')">&larr; Voltar</button>
        <h1 id="detail-title">--</h1>
        <div class="cards" id="detail-cards">
          <div class="card"><div class="card-label">Status</div><div class="card-value" id="detail-status">--</div></div>
          <div class="card"><div class="card-label">Versao</div><div class="card-value" id="detail-version">--</div></div>
          <div class="card"><div class="card-label">Memoria</div><div class="card-value" id="detail-memory">--</div></div>
          <div class="card"><div class="card-label">URL</div><div class="card-value" id="detail-url">--</div></div>
        </div>
        <div class="detail-actions">
          <button class="btn" onclick="restartInstance()">Reiniciar</button>
          <button class="btn btn-warn" onclick="resetInstance()">Resetar</button>
          <button class="btn" onclick="showUpdateVersion()">Atualizar Versao</button>
          <button class="btn btn-danger" onclick="deleteInstance()">Excluir</button>
        </div>
        <div id="version-update-form" class="hidden inline-form">
          <select id="update-version-select"></select>
          <button class="btn btn-sm" onclick="doUpdateVersion()">Confirmar</button>
        </div>
        <h2>Logs</h2>
        <div class="logs-toolbar">
          <button class="btn btn-sm" onclick="loadInstanceLogs()">Atualizar Logs</button>
        </div>
        <pre id="detail-logs" class="logs-box"></pre>
      </section>

      <!-- Create -->
      <section id="page-create" class="page hidden">
        <h1>Criar Instancia</h1>
        <div class="form-card">
          <label>Nome da Instancia</label>
          <input type="text" id="create-name" placeholder="minha-instancia" pattern="[a-z0-9\-]+" autocomplete="off">
          <label>Versao</label>
          <select id="create-version"><option value="latest">Carregando...</option></select>
          <button class="btn" id="create-btn" onclick="doCreate()">Criar</button>
          <div id="create-progress" class="hidden">
            <div class="progress-bar"><div class="progress-fill" id="create-progress-fill"></div></div>
            <p id="create-progress-msg"></p>
          </div>
          <div id="create-result" class="hidden"></div>
        </div>
      </section>

      <!-- Cleanup -->
      <section id="page-cleanup" class="page hidden">
        <h1>Preview de Cleanup</h1>
        <p class="subtitle">Instancias com 5+ dias sao removidas automaticamente.</p>
        <div class="page-header">
          <span></span>
          <button class="btn btn-sm" onclick="loadCleanup()">Atualizar</button>
        </div>
        <div id="cleanup-list" class="table-wrap"></div>
      </section>

      <!-- Debug -->
      <section id="page-debug" class="page hidden">
        <h1>Debug</h1>
        <div class="debug-section">
          <h2>Todos os Containers</h2>
          <button class="btn btn-sm" onclick="loadAllContainers()">Carregar</button>
          <div id="debug-containers" class="table-wrap"></div>
        </div>
        <div class="debug-section">
          <h2>Redes de Infra</h2>
          <button class="btn btn-sm" onclick="loadInfraNetworks()">Carregar</button>
          <pre id="debug-networks" class="logs-box"></pre>
        </div>
        <div class="debug-section">
          <h2>Traefik</h2>
          <button class="btn btn-warn" onclick="recreateTraefik()">Recriar Traefik</button>
          <pre id="debug-traefik" class="logs-box hidden"></pre>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal de confirmacao -->
  <div id="modal-overlay" class="modal-overlay hidden">
    <div class="modal">
      <p id="modal-msg"></p>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
        <button class="btn btn-danger" id="modal-confirm">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <script src="/ui/app.js"></script>
</body>
</html>
